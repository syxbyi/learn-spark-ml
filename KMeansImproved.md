这篇文章是在[Simple KMeans](./SimpleKMeans.md)的基础上做了优化, 让其可以真正投入使用.

# 一点机器学习

机器学习大概可以分这样几个步骤:

1. 数据预处理
2. 模型训练
3. 模型评估
4. 降维 & 可视化

# 预处理

## Normalize

我在上一个程序`SimpleKMeans.py`的基础上做了改进.

首先用下面的语句导入并创建一个`normalizer`, 并将我们之前创建过的`features`列作为输入列, 用第一第一范数做标准化处理.

```py
from pyspark.ml.feature import Normalizer

normalizer = Normalizer(inputCol = 'features', outputCol = 'norm_features', p = 1.0)
```

执行标准化并打印. `False`代表即使这个列很长也不要省略, 全部打印出来.

```py
norm_df = normalizer.transform(df)
norm_df.select['norm_features'].show(5, False)
```

```
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|norm_features                                                                                                                                                                                                                                                                     |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|(38,[1,2,8,19,20,25,28,29,30,32],[0.03193304293671083,0.9615198011330056,1.7642565158403772E-4,0.0014114052126723018,0.0014114052126723018,1.7642565158403772E-4,0.0015878308642563396,0.0015878308642563396,1.7642565158403772E-4,1.940682167424415E-5])                    |
|(38,[1,2,8,19,20,25,28,29,30,32],[0.30560705837222685,0.6214436417108881,0.0012786906208042965,0.010229524966434372,0.010229524966434372,0.0012786906208042965,0.02429512179528163,0.02429512179528163,0.0012786906208042965,6.393453104021483E-5])                          |
|(38,[1,2,8,19,20,25,28,29,30,32],[0.14250801986622438,0.8107796704729447,6.064171058137208E-4,0.004851336846509766,0.004851336846509766,6.064171058137208E-4,0.017586096068597904,0.017586096068597904,6.064171058137208E-4,1.8192513174411624E-5])                          |
|(38,[1,2,8,19,20,25,28,29,30,32,33],[0.16209815803304017,0.7402060419555623,6.331959298165632E-4,0.0025327837192662527,0.0025327837192662527,6.331959298165632E-4,0.0025327837192662527,0.08801423424450228,6.331959298165632E-4,1.582989824541408E-4,2.5327837192662526E-5])|
|(38,[1,2,8,19,20,25,28,29,30,32,33],[0.28351606983200794,0.3046915439273446,0.0011764152275187051,0.014116982730224461,0.014116982730224461,0.0011764152275187051,0.11058303138675828,0.26939908710178345,0.0011764152275187051,1.1764152275187051E-5,3.529245682556115E-5]) |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
```

你以与标准化之前的数据对比看看:

```
+---------------------------------------------------------------------------------------------+
|features                                                                                     |
+---------------------------------------------------------------------------------------------+
|(38,[1,2,8,19,20,25,28,29,30,32],[181.0,5450.0,1.0,8.0,8.0,1.0,9.0,9.0,1.0,0.11])            |
|(38,[1,2,8,19,20,25,28,29,30,32],[239.0,486.0,1.0,8.0,8.0,1.0,19.0,19.0,1.0,0.05])           |
|(38,[1,2,8,19,20,25,28,29,30,32],[235.0,1337.0,1.0,8.0,8.0,1.0,29.0,29.0,1.0,0.03])          |
|(38,[1,2,8,19,20,25,28,29,30,32,33],[256.0,1169.0,1.0,4.0,4.0,1.0,4.0,139.0,1.0,0.25,0.04])  |
|(38,[1,2,8,19,20,25,28,29,30,32,33],[241.0,259.0,1.0,12.0,12.0,1.0,94.0,229.0,1.0,0.01,0.03])|
+---------------------------------------------------------------------------------------------+
```

最后, 还要为KMeans对象指定输入列, 否则它又会去找`features`列.

```py
kmeans = KMeans(k = 2, seed = 1, featuresCol = 'norm_features')
model = kmeans.fit(norm_df)
```

当然, 我把k设置的太小了, 这是为了方便调试和演示. 在实际使用中k弄得大一些会更准确(100左右), 但是计算量也会很大, 需要等很久.
